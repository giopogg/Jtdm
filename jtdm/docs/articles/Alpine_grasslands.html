<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Alpine_grasslands • jtdm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Alpine_grasslands">
<meta property="og:description" content="jtdm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jtdm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Alpine_grasslands.html">Alpine grasslands</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/giopogg/Jtdm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Alpine_grasslands</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/giopogg/Jtdm/blob/HEAD/vignettes/Alpine_grasslands.Rmd" class="external-link"><code>vignettes/Alpine_grasslands.Rmd</code></a></small>
      <div class="hidden name"><code>Alpine_grasslands.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="fitting-and-evaluating-a-join-trait-distribution-model">Fitting and evaluating a join trait distribution model<a class="anchor" aria-label="anchor" href="#fitting-and-evaluating-a-join-trait-distribution-model"></a>
</h2>
<p>In this vignette we explain how to fit, evaluate and interpret a joint trait distribution model (JTDM). We refer to Poggiato et al., in prep. “Joint models and predictions of community traits” for the full description of JTDMs, and we rather focus here on presenting the R package  by applying it to the dataset of the case study presented in the publication.</p>
<div class="section level3">
<h3 id="installing-the-r-package">Installing the R package<a class="anchor" aria-label="anchor" href="#installing-the-r-package"></a>
</h3>
<p>The package implements JTDMs using the Markov Chain Monte Carlo (MCMC) Bayesian modeling software JAGS via the R package runjags. Therefore, it requires the installation of JAGS. Its installation is easy and depends on your operating system:</p>
<div class="section level6">
<h6 id="ubutntu">Ubutntu<a class="anchor" aria-label="anchor" href="#ubutntu"></a>
</h6>
<p>sudo apt-get install jags</p>
</div>
<div class="section level6">
<h6 id="windows">Windows<a class="anchor" aria-label="anchor" href="#windows"></a>
</h6>
<p><a href="https://sourceforge.net/projects/mcmc-jags/files/JAGS/4.x/Windows/" class="external-link uri">https://sourceforge.net/projects/mcmc-jags/files/JAGS/4.x/Windows/</a></p>
</div>
<div class="section level6">
<h6 id="mac">Mac<a class="anchor" aria-label="anchor" href="#mac"></a>
</h6>
<p><a href="https://sourceforge.net/projects/mcmc-jags/files/JAGS/4.x/Mac%20OS%20X/" class="external-link uri">https://sourceforge.net/projects/mcmc-jags/files/JAGS/4.x/Mac%20OS%20X/</a></p>
<p>Once JAGS has been installed, the following code should run:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"giopogg/Jtdm/jtdm"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/giopogg/Jtdm" class="external-link">jtdm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">coda</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="fit-a-jtdm-to-data">Fit a jtdm to data<a class="anchor" aria-label="anchor" href="#fit-a-jtdm-to-data"></a>
</h2>
<p>JTDMs relate a vector of average community traits (e.g. community weighted mean, CWM) to a vector of environmental covariates. The matrix Y contains the CWM traits of specific leaf area (SLA), leaf nitrogen content (LNC) and plant height of 116 plant community sites situated along 21 elevational gradients (www.orchamp.osug.fr) in the French Alps.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span>
<span><span class="co">#&gt;       SLA              LNC            Height     </span></span>
<span><span class="co">#&gt;  Min.   : 3.857   Min.   :14.86   Min.   :10.80  </span></span>
<span><span class="co">#&gt;  1st Qu.:13.225   1st Qu.:19.71   1st Qu.:23.49  </span></span>
<span><span class="co">#&gt;  Median :16.349   Median :21.42   Median :35.39  </span></span>
<span><span class="co">#&gt;  Mean   :20.500   Mean   :22.06   Mean   :34.87  </span></span>
<span><span class="co">#&gt;  3rd Qu.:21.923   3rd Qu.:23.88   3rd Qu.:44.17  </span></span>
<span><span class="co">#&gt;  Max.   :66.664   Max.   :34.30   Max.   :76.38</span></span></code></pre></div>
<p>We consider two environmental covariates: Growing Degree Days (GDD, the sum of temperature of days with positive temperature in the growing season) to represent the average length and intensity of the growing season and intensity of freezing events (Freezing Degree Days, the sum of temperature of days with negative temperature in the growing season, FDD). To account for habitat type, we included a variable that was set to 1 when the site was in a forest, 0 otherwise (hereafter habitat). These data are stored in the matrix X.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="co">#&gt;       GDD              FDD              forest      </span></span>
<span><span class="co">#&gt;  Min.   : 467.4   Min.   :-36.838   Min.   :0.0000  </span></span>
<span><span class="co">#&gt;  1st Qu.:1037.3   1st Qu.:-14.768   1st Qu.:0.0000  </span></span>
<span><span class="co">#&gt;  Median :1320.7   Median :-11.520   Median :0.0000  </span></span>
<span><span class="co">#&gt;  Mean   :1357.6   Mean   :-12.758   Mean   :0.3621  </span></span>
<span><span class="co">#&gt;  3rd Qu.:1684.9   3rd Qu.: -9.461   3rd Qu.:1.0000  </span></span>
<span><span class="co">#&gt;  Max.   :2861.5   Max.   : -2.522   Max.   :1.0000</span></span></code></pre></div>
<p>JTDMs infer a linear regression for each CWM trait as a function of the environmental covariates, together with an inter-traits residual covariance matrix. Therefore, the parameters of a JTDM are the regression coefficients <span class="math inline">\(B\)</span> and the residual covariance <span class="math inline">\(\Sigma\)</span>. Notice that inferring a generalized linear model is possible, even thus not yet implemented in our package. The inference of JTDM is implemented in the Bayesian framework (using JAGS) by the function <code>jtdm_fit</code>. The syntax of the function is similar to the popular function <code>lm</code>. This function requires the response matrix Y, the predictor matrix X and a (right-hand only) formula to specify how CWM traits depends on environmental variables. MCMC parameters are custom, details are described in <code>?rjags</code>. We choose here to include in the model linear and quadratic terms (using orthogonal polynomials) of GDD and FDD in interaction with habitat to enable non linear trait-environment relationships and to allow for different trait-environment relationships in forest and open habitats. The  is relatively fast, however, to ensure that the whole vignette runs fast, we only run short MCMC chains here, for the sake of the example. To obtain reliable results, the MCMC should be ran for a higher number of iterations.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Short MCMC to obtain a fast example: results are unreliable !</span></span>
<span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="../reference/jtdm_fit.html">jtdm_fit</a></span><span class="op">(</span>Y<span class="op">=</span><span class="va">Y</span>, X<span class="op">=</span><span class="va">X</span>, formula<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="st">"~poly(GDD,2)+poly(FDD,2)+poly(GDD,2):forest+poly(FDD,2):forest"</span><span class="op">)</span>,  adapt <span class="op">=</span> <span class="fl">10</span>, burnin <span class="op">=</span> <span class="fl">100</span>, sample <span class="op">=</span> <span class="fl">100</span>, n.chains <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="convergence-checks">Convergence checks<a class="anchor" aria-label="anchor" href="#convergence-checks"></a>
</h3>
<p>Once the model has ran, we should check for the convergence of the MCMC chains.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Potential scale reduction factor</span></span>
<span><span class="va">table</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html" class="external-link">gelman.diag</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">model</span><span class="op">$</span><span class="va">mcmc</span>,multivariate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">psrf</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">table</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"darkblue"</span>, fill<span class="op">=</span><span class="st">"lightblue"</span>,bins <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Potential scale reduction factor"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"nESS"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># nESS</span></span>
<span><span class="va">table</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/effectiveSize.html" class="external-link">effectiveSize</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">mcmc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">model</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">table</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"darkblue"</span>, fill<span class="op">=</span><span class="st">"lightblue"</span>,bins <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Effective sample size"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"nESS"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/unnamed-chunk-4-2.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="get-parameters">Get parameters<a class="anchor" aria-label="anchor" href="#get-parameters"></a>
</h3>
<p>Since we ran the JTDM with very short chains, the MCMC has not converged. You can try to run the model with longer chains and check its convergence.</p>
<p>We can now look at the inferred the regression coefficients. The <code>getB</code> function provides the MCMC samples of the regression coefficients matrix <span class="math inline">\(B\)</span>, together with its mean, and <span class="math inline">\(95\%\)</span> credible interval.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Inferred parameters</span></span>
<span><span class="va">B</span><span class="op">=</span><span class="fu"><a href="../reference/getB.html">getB</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span></span></code></pre></div>
<p><code>get_sigma</code> provides instead the MCMC samples of the residual covariance matrix <span class="math inline">\(\Sigma\)</span> together with its mean and <span class="math inline">\(95\%\)</span> credible interval.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sigma</span><span class="op">=</span><span class="fu"><a href="../reference/get_sigma.html">get_sigma</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">$</span><span class="va">Smean</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="predict-and-evaluate-model-fit">Predict and evaluate model fit<a class="anchor" aria-label="anchor" href="#predict-and-evaluate-model-fit"></a>
</h3>
<p>We can predict CWM traits on a (new) set of sites using <code>jtdm_predict</code>. Here, we predict on the training dataset and compute goodness of fit measures of these predictions like <span class="math inline">\(R^2\)</span> and RMSE, by setting <code>validation=TRUE</code>. We can choose whether to obtain the full posterior predictive distribution (<code>FullPost=TRUE</code> which is more time consuming) or just its posterior mean (<code>FullPost=FALSE</code>, which we advice if the aim is to only compute goodness of fit measures).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predictions</span> <span class="op">=</span> <span class="fu"><a href="../reference/jtdm_predict.html">jtdm_predict</a></span><span class="op">(</span><span class="va">m</span>,Xnew<span class="op">=</span><span class="va">X</span>,Ynew<span class="op">=</span><span class="va">Y</span>,validation<span class="op">=</span><span class="cn">T</span>, FullPost<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">predictions</span><span class="op">$</span><span class="va">R2</span></span>
<span><span class="co">#&gt;       SLA       LNC    Height </span></span>
<span><span class="co">#&gt; 0.5806251 0.3443389 0.5205672</span></span>
<span><span class="va">predictions</span><span class="op">$</span><span class="va">RMSE</span></span>
<span><span class="co">#&gt;      SLA      LNC   Height </span></span>
<span><span class="co">#&gt; 7.670742 2.819203 9.136419</span></span></code></pre></div>
<p>We can evaluate the performances of the model using a K-fold cross-validation using the function <code>jtdmCV</code></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predictionsCV</span> <span class="op">=</span> <span class="fu"><a href="../reference/jtdmCV.html">jtdmCV</a></span><span class="op">(</span><span class="va">m</span>,K<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predictionsCV</span><span class="op">$</span><span class="va">R2</span></span>
<span><span class="co">#&gt;       SLA       LNC    Height </span></span>
<span><span class="co">#&gt; 0.5210303 0.2208646 0.4275789</span></span>
<span><span class="va">predictionsCV</span><span class="op">$</span><span class="va">RMSE</span></span>
<span><span class="co">#&gt; [1] 9.289222 3.390048 9.851340</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="trait-environment-relationships">Trait-environment relationships<a class="anchor" aria-label="anchor" href="#trait-environment-relationships"></a>
</h3>
<p>We can now analyse the inferred trait-environment relationships using the function <code>partial_response</code>, that computes and plots the partial response curve of a focal trait along a focal environmental gradient. This function takes as input the model <code>m</code>, the focal environmental variable <code>indexGradient</code> and the focal trait <code>indexTrait</code>, using the names of environmental variables and traits as specified in the column names of X and Y respectively. The function builds a dataset of environmental variables by building the gradient of the focal environmental variable and keeping all other variables fixed to their mean. Then, it predicts the marginal distribution of the focal trait for the so-built environmental dataset. The user can choose whether to obtain the full predictive distribution (<code>FullPost=TRUE</code>), or the predictive distribution of the mean term (<code>FullPost="mean"</code>, which we advice here), or just the posterior mean (<code>FullPost="mean"</code>). The function outputs are the plot of the inferred trait-environment relationship and the predictions of the model (used to produce the plot). For example, we can plot the partial response curve relationship between SLA and GDD</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/partial_response.html">partial_response</a></span><span class="op">(</span><span class="va">m</span>,indexGradient<span class="op">=</span><span class="st">"GDD"</span>,indexTrait<span class="op">=</span><span class="st">"SLA"</span><span class="op">)</span><span class="op">$</span><span class="va">p</span></span></code></pre></div>
<p><img src="figures/unnamed-chunk-10-1.png" width="700"></p>
<p>The user can eventually provide a given gradient for the focal environmental variable <code>XFocal</code> (which is otherwise built on regual grid with length given by <code>grid.length</code>). The user can also choose to fix the non focal environmental variables to another value. For example, we can obtain the partial response curve of SLA and GDD in forest</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/partial_response.html">partial_response</a></span><span class="op">(</span><span class="va">m</span>,indexGradient<span class="op">=</span><span class="st">"GDD"</span>,indexTrait<span class="op">=</span><span class="st">"SLA"</span>,FixX<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>GDD<span class="op">=</span><span class="cn">NULL</span>,FDD<span class="op">=</span><span class="cn">NULL</span>,forest<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">p</span></span></code></pre></div>
<p><img src="figures/unnamed-chunk-11-1.png" width="700"> ## Multivariate confidence intervals</p>
<p>We can then compute the partial response curves of pairwise CWM trait combinations together with their <span class="math inline">\(95\%\)</span> credible region, what we define in the publication as the most suitable CLS and envelop of possible CLSs. This is done by the function <code>ellipse_plot</code>, that takes as input the model <code>m</code>, the focal environmental variable <code>indexGradient</code> and the two focal traits <code>indexTrait</code>, using the names of environmental variables and traits as specified in the column names of X and Y respectively. The function builds a gradient of the focal environmental variable while keeping all other variables fixed to their mean, and then predict and plots the joint distribution of the focal traits. The user can choose whether to obtain the full predictive distribution (<code>FullPost=TRUE</code>), or the predictive distribution of the mean term (<code>FullPost=F</code>, which we advice here to obtain smoother curves).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the pairwise SLA-LNC partial response curve along the GDD gradient</span></span>
<span><span class="fu"><a href="../reference/ellipse_plot.html">ellipse_plot</a></span><span class="op">(</span><span class="va">m</span>,indexTrait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SLA"</span>,<span class="st">"LNC"</span><span class="op">)</span>,indexGradient<span class="op">=</span><span class="st">"GDD"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/unnamed-chunk-12-1.png" width="700"></p>
<p>The user can also choose to fix the non-focal environmental variables to another value. For example, we can obtain the partial response curves of the most suitable CLS and envelop of possible CLSs of SLA and GDD in forest.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the pairwise SLA-LNC partial response curve along the GDD gradient</span></span>
<span><span class="fu"><a href="../reference/ellipse_plot.html">ellipse_plot</a></span><span class="op">(</span><span class="va">m</span>,indexTrait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SLA"</span>,<span class="st">"LNC"</span><span class="op">)</span>,indexGradient<span class="op">=</span><span class="st">"GDD"</span>,FixX<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>GDD<span class="op">=</span><span class="cn">NULL</span>,FDD<span class="op">=</span><span class="cn">NULL</span>,forest<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="joint-predictions">Joint predictions<a class="anchor" aria-label="anchor" href="#joint-predictions"></a>
</h3>
<p>The <code>jtdm</code> package allows to define a region in the community-trait space and compute their joint probabilities for a given set of environmental conditions. This is done by the function <code>joint_trait_prob</code>. To define a given region in the community-trait space, the user has to define the focal traits <code>indexTrait</code> (any number of traits is accepted) and trait-specific tresholds through the parameter <code>bounds</code>. <code>bounds</code> is a list of the length of <code>indexTrait</code>, where each element of the list is a vector of length two. The vector represents the inferior and superior bounds of the region for the specified trait. For example, if we consider two traits (e.g. SLA and LNC), <code>bounds=list(c(20,Inf),c(20,Inf))</code> corresponds to the region in the community-trait space where both SLA and LNC both take values greater than 20. We can then define the sites (i.e. the set of environmental conditions) in which to compute joint probabilities. For example we can compute joint probabilities of both SLA and LNC to be greater than 20 in a high altitude site. This measures the relative suitability of communities where both SLA and LNC are higher than 20 in a high altitude site.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/joint_trait_prob.html">joint_trait_prob</a></span><span class="op">(</span><span class="va">m</span>,indexTrait<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SLA"</span>,<span class="st">"LNC"</span><span class="op">)</span>, Xnew<span class="op">=</span><span class="va">X</span><span class="op">[</span><span class="st">"VCHA_2940"</span>,<span class="op">]</span>, bounds<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="cn">Inf</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="cn">Inf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">PROBmean</span></span>
<span><span class="co">#&gt;         1 </span></span>
<span><span class="co">#&gt; 0.0861943</span></span></code></pre></div>
<p>Unsurprisingly, the probability is low. Then, we compute how this probability vary along the GDD gradient using the function <code>joint_trait_prob_gradient</code>. The function builts a dataframe where the focal variable varies along a gradient and the other (non-focal) variables are fixed to their mean (but see FixX parameter for fixing non-focal variables to user-defined values) and predict the joint probabilities along the gradient.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">joint</span><span class="op">=</span><span class="fu"><a href="../reference/joint_trait_prob_gradient.html">joint_trait_prob_gradient</a></span><span class="op">(</span><span class="va">m</span>,indexTrait<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SLA"</span>,<span class="st">"LNC"</span><span class="op">)</span>, indexGradient<span class="op">=</span><span class="st">"GDD"</span>, bounds<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Y</span><span class="op">[</span>,<span class="st">"SLA"</span><span class="op">]</span><span class="op">)</span>,<span class="cn">Inf</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Y</span><span class="op">[</span>,<span class="st">"SLA"</span><span class="op">]</span><span class="op">)</span>,<span class="cn">Inf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can then plot such predictions.</p>
<p><img src="figures/unnamed-chunk-16-1.png" width="700"></p>
<p>As climatic conditions become more favorable (i.e. GDD increases), the probability of having high values of both traits increases.</p>
</div>
</div>
<div class="section level2">
<h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a>
</h2>
<p>This package is currently developed by Giovanni Poggiato from Laboratoire d’Ecologie Alpine. It is supported by the ANR GAMBAS. The framework implemented in this package is described in: Joint modeling and predictions of community traits. Poggiato Giovanni, Gaüzere Pierre, Martinez Almoyna, Camille, Deschamps, Gabrielle, Renaud, Julien, Violle, Cyrille, Münkemüller, Tamara, Thuiller, Wilfried. In preparation.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Giovanni Poggiato.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
